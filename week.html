<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Overview</title>
  <style>
    :root{
      --app-bg: #fbfaf8; /* page */
      --board-radius: 24px;

      --ink: #2b2b2b;
      --muted: #7a7a7a;
      --border: rgba(30, 30, 30, 0.10);
      --shadow: 0 10px 26px rgba(20, 20, 20, 0.08);
      --radius: 18px;

      /* Board background (behind cards). Can be set via color OR image. */
      --board-tint: #efe7e1;
      --board-tint-a: 0.35;
      --board-image: none; /* url(...) injected by JS */
    }

    *{ box-sizing: border-box; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(203,184,174,0.18), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(214,208,200,0.14), transparent 60%),
        var(--app-bg);
    }

    .wrap{
      max-width: 1180px;
      margin: 22px auto;
      padding: 16px;
    }

    .titlebar{
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .title{
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 220px;
    }

    h1{
      margin: 0;
      font-size: 18px;
      font-weight: 650;
      letter-spacing: 0.2px;
    }

    .subtitle{
      font-size: 13px;
      color: var(--muted);
    }

    /* Discreet background control: small icon button + tiny popover */
    .controls{
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .icon-pill{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.75);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      box-shadow: 0 6px 18px rgba(20,20,20,0.06);
      backdrop-filter: blur(8px);
    }

    .bg-btn{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(30,30,30,0.10);
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      display: grid;
      place-items: center;
      -webkit-tap-highlight-color: transparent;
    }
    .bg-btn:active{ transform: translateY(1px); }

    .bg-dot{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(30,30,30,0.14);
      background: var(--board-tint);
      box-shadow: 0 0 0 6px rgba(239,231,225,0.35);
    }

    .popover{
      position: relative;
    }

    .panel{
      position: absolute;
      top: 44px;
      right: 0;
      width: 260px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.92);
      box-shadow: 0 18px 40px rgba(20,20,20,0.10);
      backdrop-filter: blur(10px);
      padding: 12px;
      display: none;
      z-index: 50;
    }
    .panel.open{ display: block; }

    .panel h2{
      margin: 0 0 10px 0;
      font-size: 13px;
      font-weight: 650;
      color: rgba(43,43,43,0.85);
    }

    .row{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 8px 0;
    }

    .row label{
      font-size: 12px;
      color: var(--muted);
    }

    input[type="color"]{
      width: 34px;
      height: 26px;
      border: 1px solid rgba(30,30,30,0.12);
      border-radius: 10px;
      padding: 0;
      background: transparent;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .file{
      width: 100%;
      font-size: 12px;
      color: rgba(43,43,43,0.75);
    }

    .mini-btn{
      width: 100%;
      border: 1px solid rgba(30,30,30,0.10);
      background: rgba(255,255,255,0.90);
      border-radius: 12px;
      padding: 9px 10px;
      cursor: pointer;
      font-weight: 650;
      color: rgba(43,43,43,0.85);
      -webkit-tap-highlight-color: transparent;
    }
    .mini-btn:active{ transform: translateY(1px); }

    .hint{
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.3;
    }

    .divider{
      height: 1px;
      background: rgba(30,30,30,0.08);
      margin: 8px 0;
    }

    /* Board: background BEHIND the cards only */
    .board{
      border: 1px solid var(--border);
      border-radius: var(--board-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      background: none;
    }

    /* Two layers: image + tint wash */
    .board::before{
      content: "";
      position: absolute;
      inset: 0;
      background-image: var(--board-image);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      filter: saturate(0.95);
      transform: scale(1.02); /* hide seams */
    }

    .board::after{
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(900px 520px at 18% 20%, rgba(255,255,255,0.35), transparent 62%),
        radial-gradient(700px 460px at 82% 34%, rgba(255,255,255,0.25), transparent 62%),
        rgba(255,255,255,0.38);
      /* colored tint overlay */
      box-shadow: inset 0 0 0 9999px rgba(0,0,0,0);
      background-blend-mode: screen;
      pointer-events: none;
    }

    /* Tint layer on top of image, but still behind cards */
    .board-tint{
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0); /* set by JS using color */
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    /* Content goes above background layers */
    .board-content{
      position: relative;
      z-index: 2;
      backdrop-filter: blur(10px);
    }

    /* Grid: one row; scroll on small screens */
    .grid{
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(170px, 1fr);
      gap: 12px;
      padding: 14px;
      overflow-x: auto;
      overscroll-behavior-x: contain;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    @media (min-width: 1100px){
      .grid{
        grid-auto-flow: initial;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        overflow-x: visible;
        scroll-snap-type: none;
      }
    }

    .day{
      background: rgba(255,255,255,0.95);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(20,20,20,0.06);
      min-height: 260px;
      display: flex;
      flex-direction: column;
      scroll-snap-align: start;
    }

    .day.selected{
      outline: 3px solid rgba(203,184,174,0.35);
      outline-offset: 2px;
    }

    .day-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(30,30,30,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,1), rgba(255,255,255,0.92));
    }

    .day-title{
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    .day-name{
      font-weight: 650;
      font-size: 14px;
    }
    .day-date{
      font-size: 12px;
      color: var(--muted);
    }

    .day-color{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--muted);
    }

    .day-body{
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
    }

    .block{
      border-radius: 14px;
      padding: 10px 10px;
      border: 1px dashed rgba(30,30,30,0.14);
      background: rgba(255,255,255,0.70);
    }

    .block .label{
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="text"]{
      width: 100%;
      border: 1px solid rgba(30,30,30,0.10);
      border-radius: 12px;
      padding: 10px 10px;
      outline: none;
      background: rgba(255,255,255,0.95);
      color: var(--ink);
    }

    input[type="text"]:focus{
      border-color: rgba(30,30,30,0.18);
      box-shadow: 0 0 0 4px rgba(203,184,174,0.18);
    }

    .tasks{
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .label{
      font-size: 11px;
      color: var(--muted);
    }

    .task-row{
      display: grid;
      grid-template-columns: 18px 1fr 28px;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(30,30,30,0.08);
      background: rgba(255,255,255,0.95);
    }

    .dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #cbb8ae;
      box-shadow: 0 0 0 6px rgba(203,184,174,0.20);
      justify-self: center;
      flex: none;
    }

    .task-row input[type="text"]{
      border: none;
      background: transparent;
      padding: 8px 2px;
      border-radius: 0;
      box-shadow: none;
    }
    .task-row input[type="text"]:focus{
      border: none;
      box-shadow: none;
    }

    .icon-btn{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid rgba(30,30,30,0.10);
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      display: grid;
      place-items: center;
      color: rgba(43,43,43,0.70);
      -webkit-tap-highlight-color: transparent;
    }
    .icon-btn:active{ transform: translateY(1px); }

    .add-btn{
      width: 100%;
      border: 1px solid rgba(30,30,30,0.10);
      background: rgba(255,255,255,0.85);
      border-radius: 14px;
      padding: 10px 10px;
      cursor: pointer;
      color: rgba(43,43,43,0.85);
      font-weight: 650;
      -webkit-tap-highlight-color: transparent;
    }
    .add-btn:active{ transform: translateY(1px); }

    .footer-note{
      padding: 0 14px 14px;
      color: var(--muted);
      font-size: 12px;
      display: flex;
      gap: 10px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(30,30,30,0.10);
      background: rgba(255,255,255,0.75);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="titlebar">
      <div class="title">
        <h1>Weekly Overview</h1>
      </div>

      <div class="controls">
        <div class="popover">
          <div class="icon-pill">
            <button class="bg-btn" id="bgBtn" type="button" aria-label="Background settings" title="Background settings">
              <span class="bg-dot" aria-hidden="true"></span>
            </button>
          </div>

          <div class="panel" id="bgPanel" role="dialog" aria-label="Background settings">
            <h2>Background</h2>

            <div class="row">
              <label for="bgColor">Tint</label>
              <input id="bgColor" type="color" value="#efe7e1" />
            </div>

            <div class="row">
              <label for="bgStrength">Tint strength</label>
              <input id="bgStrength" type="range" min="0" max="70" value="35" />
            </div>

            <div class="divider"></div>

            <div class="row" style="align-items:flex-start;">
              <label for="bgImage">Image</label>
              <input id="bgImage" class="file" type="file" accept="image/*" />
            </div>

            <div class="row">
              <button class="mini-btn" id="removeImage" type="button">Remove image</button>
            </div>

            <div class="hint">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="board" id="board">
      <div class="board-tint" id="boardTint"></div>

      <div class="board-content">
        <div class="grid" id="grid"></div>

        <div class="footer-note">
          <div><span class="kbd">Enter</span> in a task field adds a new task.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function startOfWeek(d){
      // Monday start
      const date = new Date(d);
      const day = date.getDay(); // 0 Sun ... 6 Sat
      const diff = (day === 0 ? -6 : 1) - day;
      date.setDate(date.getDate() + diff);
      date.setHours(0,0,0,0);
      return date;
    }

    function formatShortDate(d){
      return d.toLocaleDateString(undefined, { month: "short", day: "numeric" });
    }

    function hexToRgba(hex, a){
      const h = hex.replace("#","").trim();
      const full = h.length === 3 ? h.split("").map(c=>c+c).join("") : h;
      const num = parseInt(full, 16);
      const r = (num >> 16) & 255;
      const g = (num >> 8) & 255;
      const b = num & 255;
      return `rgba(${r},${g},${b},${a})`;
    }

    function setDayHeaderTint(dayEl, color){
      const header = dayEl.querySelector(".day-header");
      header.style.background =
        `linear-gradient(180deg, rgba(255,255,255,1), rgba(255,255,255,0.92)),
         radial-gradient(140px 90px at 18% 24%, ${hexToRgba(color, 0.22)}, transparent 72%)`;

      dayEl.querySelectorAll(".dot").forEach(dot => {
        dot.style.background = color;
        dot.style.boxShadow = `0 0 0 6px ${hexToRgba(color, 0.20)}`;
      });
    }

    // ---------- Build UI ----------
    const dayNames = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    const defaultDayColors = ["#d9c6bd","#d6d0c8","#cdd5d0","#c9d7dd","#d1cde2","#e3d4d2","#d9d9e2"];
    const grid = $("#grid");

    let selectedDayId = "day-0";

    function taskRowHTML(color){
      return `
        <div class="task-row">
          <div class="dot" style="background:${color}; box-shadow: 0 0 0 6px ${hexToRgba(color, 0.20)}"></div>
          <input class="taskInput" type="text" placeholder="Task…" />
          <button class="icon-btn removeTask" type="button" aria-label="Remove task" title="Remove">×</button>
        </div>
      `;
    }

    function buildWeek(){
      const now = new Date();
      const monday = startOfWeek(now);

      grid.innerHTML = "";
      dayNames.forEach((name, i) => {
        const date = new Date(monday);
        date.setDate(monday.getDate() + i);

        const color = defaultDayColors[i];

        const day = document.createElement("section");
        day.className = "day";
        day.dataset.dayId = `day-${i}`;
        day.dataset.color = color;

        day.innerHTML = `
          <div class="day-header">
            <div class="day-title">
              <div class="day-name">${name}</div>
              <div class="day-date">${formatShortDate(date)}</div>
            </div>
            <div class="day-color">
              <span>color</span>
              <input class="dayColorInput" type="color" value="${color}" aria-label="Set day color"/>
            </div>
          </div>

          <div class="day-body">
            <div class="block">
              <div class="label">Focus</div>
              <input class="focusInput" type="text" placeholder="One main thing…" />
            </div>

            <div class="tasks">
              <div class="label">Tasks</div>
              <div class="taskList">
                ${taskRowHTML(color)}
              </div>
              <button class="add-btn addTask" type="button">+ Add task</button>
            </div>
          </div>
        `;

        grid.appendChild(day);
        setDayHeaderTint(day, color);
      });

      selectDay(selectedDayId);
    }

    function selectDay(dayId){
      selectedDayId = dayId;
      $$(".day").forEach(d => d.classList.toggle("selected", d.dataset.dayId === dayId));
    }

    // ---------- Discreet background settings ----------
    const board = $("#board");
    const boardTint = $("#boardTint");
    const bgBtn = $("#bgBtn");
    const bgPanel = $("#bgPanel");
    const bgColor = $("#bgColor");
    const bgStrength = $("#bgStrength");
    const bgImage = $("#bgImage");
    const removeImage = $("#removeImage");

    let currentObjectUrl = null;

    function applyBoardTint(){
      const strength = Number(bgStrength.value) / 100; // 0..0.7
      const c = bgColor.value;
      document.documentElement.style.setProperty("--board-tint", c);
      document.documentElement.style.setProperty("--board-tint-a", String(strength));

      // Update the small dot in the icon button
      const dot = $(".bg-dot");
      dot.style.background = c;
      dot.style.boxShadow = `0 0 0 6px ${hexToRgba(c, Math.min(0.35, strength + 0.1))}`;

      // Tint layer (multiply) behind cards
      boardTint.style.background = hexToRgba(c, strength);
    }

    function setBoardImage(urlOrNone){
      document.documentElement.style.setProperty("--board-image", urlOrNone ? `url("${urlOrNone}")` : "none");
    }

    // Toggle panel (discreet)
    bgBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      bgPanel.classList.toggle("open");
    });

    // Click outside closes
    document.addEventListener("click", (e) => {
      if (!bgPanel.classList.contains("open")) return;
      const inside = e.target.closest("#bgPanel") || e.target.closest("#bgBtn");
      if (!inside) bgPanel.classList.remove("open");
    });

    // Inputs
    bgColor.addEventListener("input", applyBoardTint);
    bgStrength.addEventListener("input", applyBoardTint);

    bgImage.addEventListener("change", () => {
      const file = bgImage.files && bgImage.files[0];
      if (!file) return;

      // Release previous object URL if any
      if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);

      currentObjectUrl = URL.createObjectURL(file);
      setBoardImage(currentObjectUrl);
    });

    removeImage.addEventListener("click", () => {
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }
      bgImage.value = "";
      setBoardImage(null);
    });

    // ---------- Event handling (don’t steal focus; mobile-friendly) ----------
    grid.addEventListener("click", (e) => {
      // Keep inputs/buttons behaving normally
      if (e.target.closest("input, button")) return;

      const day = e.target.closest(".day");
      if (day) selectDay(day.dataset.dayId);
    });

    grid.addEventListener("input", (e) => {
      if (e.target.classList.contains("dayColorInput")){
        const day = e.target.closest(".day");
        const color = e.target.value;
        day.dataset.color = color;
        setDayHeaderTint(day, color);
      }
    });

    grid.addEventListener("click", (e) => {
      const addBtn = e.target.closest(".addTask");
      if (addBtn){
        const day = addBtn.closest(".day");
        addTask(day);
        return;
      }

      const rmBtn = e.target.closest(".removeTask");
      if (rmBtn){
        const day = rmBtn.closest(".day");
        const row = rmBtn.closest(".task-row");
        const list = day.querySelector(".taskList");
        row.remove();
        if (!list.querySelector(".task-row")) addTask(day, true);
        return;
      }
    });

    function addTask(dayEl, focusNew = true){
      const list = dayEl.querySelector(".taskList");
      const color = dayEl.dataset.color || "#cbb8ae";

      const wrap = document.createElement("div");
      wrap.innerHTML = taskRowHTML(color);
      const row = wrap.firstElementChild;
      list.appendChild(row);

      if (focusNew){
        row.querySelector(".taskInput").focus({ preventScroll: false });
      }
    }

    grid.addEventListener("keydown", (e) => {
      if (e.target.classList && e.target.classList.contains("taskInput")){
        if (e.key === "Enter"){
          e.preventDefault();
          addTask(e.target.closest(".day"), true);
        }
      }
    });

    // ---------- Init ----------
    buildWeek();
    applyBoardTint();
    setBoardImage(null);
  </script>
</body>
</html>
